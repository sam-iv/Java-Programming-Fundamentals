# Generated by gitlab_conf_com1027.py
image: registry.eps.surrey.ac.uk/com1027:2022-23

variables:
  MAVEN_CLI_OPTS: "-s .m2/settings.xml --batch-mode -fae"
  MAVEN_OPTS: "-Dmaven.repo.local=.m2/repository"

stages:
  - build
  - test

.default-build: &build
  stage: build
  tags:
    - production
  script:
    - cd $LAB; mvn $MAVEN_CLI_OPTS compile
  rules:
    - changes:
        - $LAB/**/*

.default-test: &test
  stage: test
  tags:
    - production
  needs:
    - build-$LAB
  script:
    - apk add tree; cd $LAB; mvn $MAVEN_CLI_OPTS surefire-report:report; tree
  rules:
    - changes:
        - $LAB/**/*
  artifacts:
    reports:
      junit:
        - "$LAB/**/*/TEST-*.xml"
    expire_in: 52 weeks

build-lab01:
  <<: [*build]
  variables:
    LAB: Lab01

test-lab01:
  <<: [*test]
  variables:
    LAB: Lab01
  needs:
    - build-lab01

build-lab02:
  <<: [*build]
  variables:
    LAB: Lab02

test-lab02:
  <<: [*test]
  variables:
    LAB: Lab02
  needs:
    - build-lab02

build-lab03:
  <<: [*build]
  variables:
    LAB: Lab03

test-lab03:
  <<: [*test]
  variables:
    LAB: Lab03
  needs:
    - build-lab03

build-lab04:
  <<: [*build]
  variables:
    LAB: Lab04

test-lab04:
  <<: [*test]
  variables:
    LAB: Lab04
  needs:
    - build-lab04

build-lab05:
  <<: [*build]
  variables:
    LAB: Lab05

test-lab05:
  <<: [*test]
  variables:
    LAB: Lab05
  needs:
    - build-lab05

build-lab06:
  <<: [*build]
  variables:
    LAB: Lab06

test-lab06:
  <<: [*test]
  variables:
    LAB: Lab06
  needs:
    - build-lab06

build-lab07:
  <<: [*build]
  variables:
    LAB: Lab07

test-lab07:
  <<: [*test]
  variables:
    LAB: Lab07
  needs:
    - build-lab07

build-lab08:
  <<: [*build]
  variables:
    LAB: Lab08

test-lab08:
  <<: [*test]
  variables:
    LAB: Lab08
  needs:
    - build-lab08

build-lab09:
  <<: [*build]
  variables:
    LAB: Lab09

test-lab09:
  <<: [*test]
  variables:
    LAB: Lab09
  needs:
    - build-lab09

build-lab10:
  <<: [*build]
  variables:
    LAB: Lab10

test-lab10:
  <<: [*test]
  variables:
    LAB: Lab10
  needs:
    - build-lab10

build-lab11:
  <<: [*build]
  variables:
    LAB: Lab11

test-lab11:
  <<: [*test]
  variables:
    LAB: Lab11
  needs:
    - build-lab11
